\documentclass[10pt]{article}
\usepackage{float}
\usepackage{amsmath}
\usepackage{paralist}
\usepackage{setspace}
\usepackage{listings}
\usepackage{graphicx}
\usepackage[english]{babel}
\usepackage{geometry}
\usepackage{subcaption}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{color}
\usepackage{subcaption}
\usepackage{hyperref}


\begin{document}


\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{ %
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  basicstyle=\footnotesize,        % the size of the fonts that are used for the code
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  deletekeywords={...},            % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  frame=tb,	                   % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
  language=Octave,                 % the language of the code
  otherkeywords={*,...},           % if you want to add more keywords to the set
  numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stepnumber=2,                    % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{mymauve},     % string literal style
  tabsize=2,	                   % sets default tabsize to 2 spaces
  title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
}



\onehalfspacing
\input{titlepage.tex}
\tableofcontents
\newpage
\section*{Introduction}
In this third learning unit of the Wind Physics Measurement Project the goal was to perform a long term assessment of wind resources for the windpark Kriegers Flak2 close to the FINO2 met mast in the Baltic Sea. As reanalysis data for wind speeds and directions a 24 year time-series called MERRA-2 was provided. This report describes how the short-term measurement data and the reanalysis data were taken to derive long-term corrected data for Fino2 by applying the Sectoral Regression MCP method.
 
\section{Synchronizing the data}
In task 1 we were asked to synchronize the data of FINO2 and MERRA-2. The data of FINO2 was provided in 10 minute-averages over five years starting in January 2010. The MERRA-2 data is the so called long term data provided in one hour-averages, ranging from 1992 to 2016.
Preprocessement of the data included neglection of all measured data of FINO 2 after end of May 2014 and computation of one hour averages at a height of 90 m.
We used the following routine:
\begin{lstlisting}
last_timestamp = find(Fino2.time==datenum('31-May-2014 23:55:00'));
for i = 1:last_timestamp/6
    fino2_1h_v92(i,1) = datenum('01-Jan-2010 00:00:00')+(i-1)*1/24;
    range_array_v = fino2_v92((i-1)*6+1:i*6,1);
    range_array_dir = fino2_d91((i-1)*6+1:i*6,1);
    fino2_1h_v92(i,3) = nanmean(range_array_v);
    fino2_1h_v92(i,2) = nanmean(range_array_dir);
end
\end{lstlisting}
This routine calculates the last time stamp of the data and returns the corresponding line in the cell. The for loop creates a continuous time axis with one hour intervals  In addition it calculates the mean of six 10-minutes intervals for wind speeds and wind directions.\\
Since we can only synchronize corresponding time intervals of FINO 2 and MERRA-2 we also had to calculate the correct time stamps of MERRA-2. 
\begin{lstlisting}
timestamps = raw_data.Var1(:,1); % MERRA-2 Data
first_timestamp = find(strcmp(timestamps(:), '01.01.2010 00:00'));
last_timestamp = find(strcmp(timestamps(:), '31.05.2014 23:00'));
\end{lstlisting}
After finding the correct time stamps we finally we able to save the data in one variable, called $connected_data$.\\
Synchronizing the data means that we only take time stamps into account when both measurement systems have entries. Incorrect data of FINO 2 is marked with NaN values. The data of MERRA-2 has additional status columns. $0$ as an entry means correct measurement.
\begin{lstlisting}
count = 0 
for i = 1:length(connected_data(:,1))
    if raw_data.Var8(i) ~= 0 || raw_data.Var9(i) ~= 0 || isnan(connected_data(i,2)) == 1 || isnan(connected_data(i,3)) == 1
        connected_data(i,2:5) = NaN;
        count = count +1;
    end
end
\end{lstlisting}
\section{Sorting into 12 wind sectors}
In order to sort the synchronized data in 12 sectors we decided to save all sectors in one variable. The use of only one variable instead of initializing 12 different variables helped to achieve a more structured code.
Here is an abstract of our source code for Task 2.
\begin{lstlisting}
for i = 1:length(connected_data(:,1))
    if ~isnan(connected_data(i,3))
        sortIndex = floor(connected_data(i,3)/360*12)+1;
        sortedCell{sortIndex*3-2} = [sortedCell{sortIndex*3-2}, connected_data(i,1)]; %timestamp
        sortedCell{sortIndex*3-1} = [sortedCell{sortIndex*3-1}, connected_data(i,4)]; %merra 2
        sortedCell{sortIndex*3} = [sortedCell{sortIndex*3}, connected_data(i,2)]; %fino 2
    end;
end;
\end{lstlisting} 
The variable $sortedCell$ is separated into 12 sectors. Each sector consists of 3 columns: corresponding time stamp, windspeeds of FINO 2 and windspeeds of MERRA-2.
\section{Monthly averages of sectors}
In Task 3 we calculated the monthly averages for every sector and for all data. 
\section{Regressions parameters and plots} 
In Task 4 \& 5 we were asked to create regressions plots of the monthly averages of each sector. In addition we also had to calculate the corresponding regression parameters. We used the provided plot routine:
\begin{lstlisting}
plotregression(avgSectorPerMonth(:,i*2), avgSectorPerMonth(:,i*2+1), 'Regression');
    [regressionParameters(i,1),  regressionParameters(i,2), regressionParameters(i,3)]...
     =  regression(avgSectorPerMonth(:,i*2), avgSectorPerMonth(:,i*2+1), 'one');

\end{lstlisting}
Figure~\ref{fig:Regression} shows the resulting plot for sector 0 - 30 $\deg$ and sector 120 - 150 $\deg$.
\begin{figure}[H]
\begin{subfigure}{0.5\textwidth}
  \centering
  \includegraphics[width=1\linewidth]{../figures/scatterPlot_Sector0.jpg}
  \caption{Sector 0 - 30 $\deg$}
\end{subfigure}
\begin{subfigure}{0.5\textwidth}
  \centering
  \includegraphics[width=1\linewidth]{../figures/scatterPlot_Sector120.jpg}
  \caption{Sector 120 - 150 $\deg$}
\end{subfigure}
  \caption{Regressions Plots}
\label{fig:Regression}
\end{figure}
\end{document}